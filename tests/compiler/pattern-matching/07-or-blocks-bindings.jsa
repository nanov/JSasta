// Test that || blocks pattern bindings in if body
// jastat: mode=run, capture=assert

import io from @io;
import t from @test;

enum Message {
    quit;
    move(x: i32, y: i32);
}

let msg = Message.move{x: 10, y: 20};

// This should work - no || so bindings are available
let branch1: i32 = 0;
if (msg is Message.move(let x, let y) && x == 10) {
    // io.println("With &&: x={}, y={}", x, y);
    t.assert.equals(10, x);
    t.assert.equals(20, y);
    branch1 = 1;
}

t.assert.equals(1, branch1);

// This should also work - || is allowed if bindings aren't used after it
let branch2: i32 = 0;
if (msg is Message.move(let a, let b) || false) {
    // a and b are NOT available here due to ||
    // io.println("With ||: bindings not available");
    branch2 = 1;
}

t.assert.equals(1, branch2);

// jastat-summary: Methods that modify structs through references
// jastat: mode=run, capture=assert

import io from @io;
import t from @test;

struct Point {
    x: i32;
    y: i32;
}

function set_point(self: ref Point, x: i32, y: i32): void {
    self.x = x;
    self.y = y;
}

function add_to(self: ref Point, other: Point): void {
    self.x = self.x + other.x;
    self.y = self.y + other.y;
}

function scale_by(self: ref Point, factor: i32): void {
    self.x = self.x * factor;
    self.y = self.y * factor;
}

function print_point(self: Point, name: i32): void {
    io.println("p{}: ({}, {})", name, self.x, self.y);
}

var p1: Point;
var p2: Point;
var sum: Point;

set_point(ref p1, 10, 20);
set_point(ref p2, 5, 15);

// print_point(p1, 1);
// print_point(p2, 2);
t.assert.equals(10, p1.x);
t.assert.equals(20, p1.y);
t.assert.equals(5, p2.x);
t.assert.equals(15, p2.y);

set_point(ref sum, p1.x, p1.y);
add_to(ref sum, p2);
// print_point(sum, 3);
t.assert.equals(15, sum.x);
t.assert.equals(35, sum.y);

set_point(ref sum, p1.x, p1.y);
scale_by(ref sum, 3);
// print_point(sum, 4);
t.assert.equals(30, sum.x);
t.assert.equals(60, sum.y);
